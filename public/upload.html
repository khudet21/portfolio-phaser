<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upload Gambar</title>
  </head>
  <body>
    <h1>Upload Gambar</h1>

    <form action="/upload" method="POST" enctype="multipart/form-data">
      <input type="file" name="image" required />
      <button type="submit">Upload</button>
    </form>

    <h2>Daftar Gambar</h2>
    <table border="1" id="imageTable">
      <thead>
        <tr>
          <th>Nama File</th>
          <th>Preview</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      async function loadImages() {
        const res = await fetch("/images");
        const images = await res.json();

        const tbody = document.querySelector("#imageTable tbody");
        tbody.innerHTML = "";

        for (const img of images) {
          const tr = document.createElement("tr");

          const nameTd = document.createElement("td");
          nameTd.textContent = img.name;

          const imgTd = document.createElement("td");
          const image = document.createElement("img");
          image.src = `/image/${img.id}`;
          image.style.maxHeight = "50px";
          imgTd.appendChild(image);

          const actionTd = document.createElement("td");
          const btn = document.createElement("button");
          btn.textContent = "Hapus";
          btn.onclick = async () => {
            if (confirm("Yakin mau hapus gambar ini?")) {
              await fetch(`/image/${img.id}`, { method: "DELETE" });
              loadImages();
            }
          };
          actionTd.appendChild(btn);

          tr.appendChild(nameTd);
          tr.appendChild(imgTd);
          tr.appendChild(actionTd);
          tbody.appendChild(tr);
        }
      }

      // Panggil saat halaman dimuat
      loadImages();
    </script>
  </body>
</html>
